#!/usr/bin/python2.7
# -*- coding: utf-8 -*-

import sys
import os

# we should be SOMETHING/bin/reset_admin_password, find APPDIR
# and add "SOMETHING/src" to our path

APPDIR = os.path.join(os.path.dirname(os.path.dirname(os.path.realpath(__file__))), "src")
sys.path.append(APPDIR)

from oasis import db
from oasis.lib import OaConfig
from oasis.models.User import User
from oasis.models.Permission import Permission

u = User.get_by_uname('admin')
if not u:
    u = User.create(username="admin",
                    passwd="NOLOGIN",
                    email=OaConfig.email,
                    givenname="Admin",
                    familyname="Account",
                    acctstatus=1,
                    student_id="",
                    source="local",
                    confirmation_code="",
                    confirmed=True)

passwd = u.gen_confirm_code()
u.set_password(passwd)
Permission.add_perm(u.id, 0, 1)  # superuser
print "The new admin password is:  ", passwd
db.session.add(u)
db.session.commit()

